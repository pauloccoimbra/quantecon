<!-- Inserção/controlador do botão ☰ (único) e preferência salva -->
<script>
(function () {
  function setCollapsed(on) {
    document.documentElement.classList.toggle('sidebar-collapsed', !!on);
    try { localStorage.setItem('qe_sidebar_collapsed', on ? '1' : '0'); } catch (e) {}
    var btn = document.getElementById('sidebarToggle');
    if (btn) btn.setAttribute('aria-pressed', on ? 'true' : 'false');
  }

  // Aplica estado salvo (ou inicia recolhido no mobile, se nada salvo)
  try {
    var saved = localStorage.getItem('qe_sidebar_collapsed');
    var startCollapsed = (saved === '1') || (saved === null && window.innerWidth <= 991);
    setCollapsed(startCollapsed);
    // Tema claro (remova se não quiser forçar)
    localStorage.setItem('theme', 'light');
    document.documentElement.setAttribute('data-theme', 'light');
  } catch (e) {}

  document.addEventListener('DOMContentLoaded', function () {
    // Remove duplicatas antigas do botão, se existirem
    var dups = document.querySelectorAll('#sidebarToggle');
    for (var i = 1; i < dups.length; i++) dups[i].remove();

    var btn = document.getElementById('sidebarToggle');
    if (!btn) {
      btn = document.createElement('button');
      btn.id = 'sidebarToggle';
      btn.type = 'button';
      btn.title = 'Mostrar/ocultar navegação';
      btn.setAttribute('aria-label','Mostrar/ocultar navegação');
      btn.textContent = '☰';
    }

    // Insere no começo do header (fica no fluxo, sem sobrepor busca/conteúdo)
    var header = document.querySelector('.main-header');
    if (header && !header.contains(btn)) header.insertBefore(btn, header.firstChild);

    // Click → alterna
    btn.addEventListener('click', function () {
      var on = document.documentElement.classList.contains('sidebar-collapsed');
      setCollapsed(!on);
    });
  });
})();
</script>
