<!-- Botão ☰ único + controlador de estado -->
<script>
(function () {
  function setCollapsed(on) {
    document.documentElement.classList.toggle('sidebar-collapsed', !!on);
    try { localStorage.setItem('qe_sidebar_collapsed', on ? '1' : '0'); } catch (e) {}
    var btn = document.getElementById('sidebarToggle');
    if (btn) btn.setAttribute('aria-pressed', on ? 'true' : 'false');
  }

  // Aplica preferência salva; se nada salvo, inicia recolhida no mobile
  try {
    var saved = localStorage.getItem('qe_sidebar_collapsed');
    var startCollapsed = (saved === '1') || (saved === null && window.innerWidth <= 991);
    setCollapsed(startCollapsed);
    // Força tema claro (remova se não quiser)
    localStorage.setItem('theme','light');
    document.documentElement.setAttribute('data-theme','light');
  } catch (e) {}

  document.addEventListener('DOMContentLoaded', function () {
    // Remove botões duplicados, se existirem
    var olds = document.querySelectorAll('#sidebarToggle');
    for (var i = 1; i < olds.length; i++) olds[i].remove();

    // Cria (ou reaproveita) o botão
    var btn = document.getElementById('sidebarToggle');
    if (!btn) {
      btn = document.createElement('button');
      btn.id = 'sidebarToggle';
      btn.type = 'button';
      btn.title = 'Mostrar/ocultar navegação';
      btn.setAttribute('aria-label','Mostrar/ocultar navegação');
      btn.textContent = '☰';
    }

    // Tenta colocar no header; se não houver, usa fallback flutuante
    var header = document.querySelector('.main-header');
    if (header) {
      if (!header.contains(btn)) header.insertBefore(btn, header.firstChild);
      btn.classList.remove('floating');
    } else {
      if (!document.body.contains(btn)) document.body.appendChild(btn);
      btn.classList.add('floating');
    }

    // Clique → alterna recolhido/aberto
    btn.addEventListener('click', function () {
      var on = document.documentElement.classList.contains('sidebar-collapsed');
      setCollapsed(!on);
    });
  });
})();
</script>
